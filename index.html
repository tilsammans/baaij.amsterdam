<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The French Winter Adventure</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        #question_locked { max-height: 75vh; }
        video { max-height: 90vh; }
        #locked header {
            display: flex;            /* Enable flexbox layout */
            justify-content: center;  /* Center content by default */
            align-items: center;      /* Align items vertically */
            text-align: center;       /* Ensure text is centered */
            position: relative;       /* Positioning context for absolute positioning */
        }
        #locked header button {
            position: absolute;       /* Position the button absolutely within the header */
            right: 0;                 /* Align it to the right */
            top: 50%;                 /* Align it to the top, then adjust with transform for centering */
            transform: translateY(-50%); /* Center the button vertically */
        }
    </style>
</head>
<body>
    <h1>The French Winter Adventure</h1>
    <p>
        Daag je kennis van Frankrijk uit, laat je verbluffen en blijf allert. Maar
        onthoud, je locatie speelt een cruciale rol; alleen op de juiste plekken
        zullen de mysterieuze “deuren” voor jullie opengaan. Durf jij de ultieme
        test van geduld aan te gaan?
    </p>
    <p><strong>Om door te kunnen gaan is je locatie nodig.</strong></p>
    <p><button onclick="getLocation()">Check mijn locatie</button></p>
    <dialog id="locked">
        <header>Nog niet...<button onclick="closeDialog('locked')">×</button></header>
        <img id="question_locked" src="unlock.jpg">
    </dialog>
    <dialog id="open">
        <header>Yes! Question unlocked</header>
        Stel er is een Fransman en die eet alleen Franse kazen
        En zij eet van elke franse kaas die er gemaakt wordt
        Van elke kaas eet ze precies evenveel in een jaar
        Hoeveel KG eet zij dan gemiddeld per kaassoort per jaar (afgerond)?
        LET OP – NIET GOKKEN!
        <div>
            <button id="answer_a" onclick="answer('a')">14 KG</button>
            <button id="answer_b" onclick="answer('b')">14 gram</button>
            <button id="answer_c" onclick="answer('c')">2 gram</button>
        </div>
    </dialog>
    <dialog id="answer_video">
        <video controls>
            <source src="output.mp4" type="video/mp4">
            Your browser does not support the video tag.
          </video>
    </dialog>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        var centerFrance = { lat: 46.709735, lng: 1.719103 };

        // Radius of the geofence in meters
        var radius = 500000;

        // Function to calculate the distance between two points
        function getDistanceFromLatLonInKm(point1, point2) {
            var R = 6371; // Radius of the earth in km
            var dLat = deg2rad(point2.lat - point1.lat);
            var dLon = deg2rad(point2.lng - point1.lng);
            var a =
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(deg2rad(point1.lat)) * Math.cos(deg2rad(point2.lat)) *
                Math.sin(dLon/2) * Math.sin(dLon/2)
            ;
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            var distance = R * c; // Distance in km
            return distance * 1000; // Distance in meters
        }

        function deg2rad(deg) {
            return deg * (Math.PI/180)
        }

        // Function to check if a point is inside the circle
        function isInsideCircle(point, center, radius) {
            var distance = getDistanceFromLatLonInKm(center, point);
            return distance <= radius;
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        function showPosition(position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;

            var isWithinFrance = isInsideCircle({lat: position.coords.latitude, lng: position.coords.longitude}, centerFrance, radius);

            if (isWithinFrance) {
                document.getElementById('open').showModal();
            } else {
                document.getElementById('locked').showModal();
            }
        }

        function showError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    alert("User denied the request for Geolocation.");
                    break;
                case error.POSITION_UNAVAILABLE:
                    alert("Location information is unavailable.");
                    break;
                case error.TIMEOUT:
                    alert("The request to get user location timed out.");
                    break;
                case error.UNKNOWN_ERROR:
                    alert("An unknown error occurred.");
                    break;
            }
        }

        function closeDialog(id) {
            var dialog = document.getElementById(id);
            dialog.close();
        }

        function answer(value) {
            var dialog = document.getElementById('open');
            dialog.close();

            if(value === 'b') {
                var video = document.getElementById('answer_video');
                video.showModal();
            }
        }
    </script>
</body>
</html>
